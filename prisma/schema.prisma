generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

// –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ (Telegram + –∫–æ—à–µ–ª—å–∫–∏)
model User {
  id                String    @id @default(cuid())
  telegramId        String?   @unique
  telegramUsername  String?
  telegramPhotoUrl  String?
  telegramFirstName String?
  telegramAuthDate  DateTime?
  username          String?
  plan              Plan      @default(FREE)
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt

  wallets          Wallet[]
  projects         Project[]
  aiGenerations    AiGeneration[]
  comments         Comment[]
  reactions        Reaction[]
  commentReactions CommentReaction[]

  @@map("users")
}

// –ö–æ—à–µ–ª—å–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–æ–¥–∏–Ω User -> –º–Ω–æ–≥–æ Wallet)
model Wallet {
  id              String    @id @default(cuid())
  userId          String
  user            User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  address         String    @unique  // axm1... lowercase
  label           String?
  isPrimary       Boolean   @default(false)
  verifiedAt      DateTime  @default(now())
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  @@index([userId])
  @@map("wallets")
}

enum Plan {
  FREE
  PRO
}

// –ü—Ä–æ–µ–∫—Ç—ã —Ç–æ–∫–µ–Ω–æ–≤
model Project {
  id               String        @id @default(cuid())
  ownerId          String
  owner            User          @relation(fields: [ownerId], references: [id])
  creatorWallet    String?       // Which wallet was used to create this project

  tokenAddress     String?       @unique
  name             String
  ticker           String
  logo             String?

  descriptionShort String?
  descriptionLong  String?       @db.Text

  // JSON –ø–æ–ª—è
  links            Json?         // { telegram, twitter, website, discord }
  tokenomics       Json?         // { supply, distribution, vesting, tax }
  launchPlan       Json?         // –ø–ª–∞–Ω –∑–∞–ø—É—Å–∫–∞
  faq              Json?         // –≤–æ–ø—Ä–æ—Å—ã-–æ—Ç–≤–µ—Ç—ã
  promoTexts       Json?         // —Ç–µ–∫—Å—Ç—ã –¥–ª—è –ø–æ—Å—Ç–æ–≤

  // CW20 Token Parameters
  decimals            Int           @default(6)
  initialSupply       String?

  status              ProjectStatus @default(DRAFT)
  isFeatured          Boolean       @default(false)
  isVerified          Boolean       @default(false)

  // Launch dates
  presaleStartDate    DateTime?
  presaleEndDate      DateTime?
  estimatedLaunchDate DateTime?

  createdAt        DateTime      @default(now())
  updatedAt        DateTime      @updatedAt

  metrics          TokenMetric[]
  riskFlags        RiskFlag[]
  comments         Comment[]
  reactions        Reaction[]

  @@map("projects")
}

enum ProjectStatus {
  DRAFT      // –ß–µ—Ä–Ω–æ–≤–∏–∫, –≤–∏–¥–µ–Ω —Ç–æ–ª—å–∫–æ –∞–≤—Ç–æ—Ä—É
  UPCOMING   // –°–∫–æ—Ä–æ –∑–∞–ø—É—Å–∫, –≤–∏–¥–µ–Ω –≤—Å–µ–º –≤ Upcoming
  PRESALE    // –ü—Ä–µ—Å–µ–π–ª –∞–∫—Ç–∏–≤–µ–Ω
  PUBLISHED  // –û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω (legacy)
  LAUNCHED   // –¢–æ–∫–µ–Ω —Å–æ–∑–¥–∞–Ω –≤ –±–ª–æ–∫—á–µ–π–Ω–µ
  ARCHIVED
}

// –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ —Ç–æ–∫–µ–Ω–æ–≤
model TokenMetric {
  id              String   @id @default(cuid())
  projectId       String
  project         Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)

  date            DateTime @db.Date
  txCount         Int      @default(0)
  volumeEstimate  Float    @default(0)
  holdersEstimate Int      @default(0)
  priceUsd        Float?

  createdAt       DateTime @default(now())

  @@unique([projectId, date])
  @@map("token_metrics")
}

// –§–ª–∞–≥–∏ —Ä–∏—Å–∫–∞ –¥–ª—è —Ç–æ–∫–µ–Ω–æ–≤
model RiskFlag {
  id        String       @id @default(cuid())
  projectId String
  project   Project      @relation(fields: [projectId], references: [id], onDelete: Cascade)

  flagType  RiskFlagType
  severity  Severity     @default(MEDIUM)
  details   Json?
  isActive  Boolean      @default(true)

  createdAt DateTime     @default(now())

  @@map("risk_flags")
}

enum RiskFlagType {
  TOO_NEW              // —Å–ª–∏—à–∫–æ–º –Ω–æ–≤—ã–π
  NO_SOCIALS           // –Ω–µ—Ç —Å–æ—Ü—Å–µ—Ç–µ–π
  HIGH_CONCENTRATION   // –≤—ã—Å–æ–∫–∞—è –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏—è —É —Ç–æ–ø-—Ö–æ–ª–¥–µ—Ä–æ–≤
  LOW_LIQUIDITY        // –Ω–∏–∑–∫–∞—è –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å
  SUDDEN_PUMP          // —Ä–µ–∑–∫–∏–π –ø–∞–º–ø
  SUDDEN_DUMP          // —Ä–µ–∑–∫–∏–π –¥–∞–º–ø
  HONEYPOT_SUSPECT     // –ø–æ–¥–æ–∑—Ä–µ–Ω–∏–µ –Ω–∞ honeypot
  UNLOCKED_SUPPLY      // –Ω–µ–∑–∞–ª–æ—á–µ–Ω–Ω—ã–π supply
}

enum Severity {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}

// AI –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ (–¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –ª–∏–º–∏—Ç–æ–≤)
model AiGeneration {
  id         String           @id @default(cuid())
  userId     String
  user       User             @relation(fields: [userId], references: [id])

  type       AiGenerationType
  promptHash String           // –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
  input      Json             // –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
  result     Json             // —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
  model      String           // –∫–∞–∫–∞—è –º–æ–¥–µ–ª—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞—Å—å

  createdAt  DateTime         @default(now())

  @@index([promptHash])
  @@map("ai_generations")
}

enum AiGenerationType {
  TOKENOMICS
  DESCRIPTION
  FAQ
  LAUNCH_PLAN
  PROMO
  FULL_PACKAGE
}

// –ü–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ –∞–ª–µ—Ä—Ç—ã (–¥–ª—è –±–æ—Ç–∞)
model AlertSubscription {
  id            String    @id @default(cuid())
  telegramId    String

  alertType     AlertType
  tokenAddress  String?   // –¥–ª—è –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–æ–∫–µ–Ω
  isActive      Boolean   @default(true)

  createdAt     DateTime  @default(now())

  @@unique([telegramId, alertType, tokenAddress])
  @@map("alert_subscriptions")
}

enum AlertType {
  NEW_TOKEN
  VOLUME_SPIKE
  PRICE_CHANGE
  RISK_FLAG
  TOKEN_UPDATE
}

// –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ –ø—Ä–æ–µ–∫—Ç–∞–º
model Comment {
  id        String            @id @default(cuid())
  projectId String
  project   Project           @relation(fields: [projectId], references: [id], onDelete: Cascade)
  userId    String
  user      User              @relation(fields: [userId], references: [id])
  content   String            @db.Text
  isEdited  Boolean           @default(false)
  createdAt DateTime          @default(now())
  updatedAt DateTime          @updatedAt
  reactions CommentReaction[]

  @@index([projectId, createdAt])
  @@map("comments")
}

// –†–µ–∞–∫—Ü–∏–∏ –Ω–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
model CommentReaction {
  id        String              @id @default(cuid())
  commentId String
  comment   Comment             @relation(fields: [commentId], references: [id], onDelete: Cascade)
  userId    String
  user      User                @relation(fields: [userId], references: [id])
  type      CommentReactionType
  createdAt DateTime            @default(now())

  @@unique([commentId, userId, type])
  @@index([commentId])
  @@map("comment_reactions")
}

enum CommentReactionType {
  LIKE    // üëç
  DISLIKE // üëé
  LAUGH   // üòÇ
  LOVE    // ‚ù§Ô∏è
}

// –†–µ–∞–∫—Ü–∏–∏ –Ω–∞ –ø—Ä–æ–µ–∫—Ç—ã
model Reaction {
  id        String       @id @default(cuid())
  projectId String
  project   Project      @relation(fields: [projectId], references: [id], onDelete: Cascade)
  userId    String
  user      User         @relation(fields: [userId], references: [id])
  type      ReactionType
  createdAt DateTime     @default(now())

  @@unique([projectId, userId, type])
  @@index([projectId])
  @@map("reactions")
}

enum ReactionType {
  ROCKET   // üöÄ
  FIRE     // üî•
  HEART    // ‚ù§Ô∏è
  EYES     // üëÄ
  WARNING  // ‚ö†Ô∏è
}

// –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–æ–Ω–Ω—ã–µ challenge –¥–ª—è –∫–æ—à–µ–ª—å–∫–æ–≤
model WalletVerification {
  id              String   @id @default(cuid())
  walletAddress   String   @unique
  code            String   // –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–æ–¥ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏
  expiresAt       DateTime
  createdAt       DateTime @default(now())

  // –°–≤—è–∑—å —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞ ‚Äî –∫–æ—à–µ–ª—ë–∫ –ø—Ä–∏–≤—è–∑—ã–≤–∞–µ—Ç—Å—è –∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é)
  userId          String

  @@index([walletAddress])
  @@index([code])
  @@map("wallet_verifications")
}
